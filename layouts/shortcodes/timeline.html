{{ $error := false }}

{{- $data := .Get "data" -}}
{{ if not $data -}}
    {{ errorf "Missing param 'data': %s" .Position -}}
    {{ $error = true }}
{{ end -}}

{{ $entries := index site.Data $data }}
{{ if not $entries -}}
    {{ errorf "Invalid timeline data '%s': %s" $data .Position -}}
    {{ $error = true }}
{{ end -}}


<!-- Inline partial to render icon -->
{{- define "partials/timeline-icon.html" -}}
    {{- $icon := .icon -}}
    {{- $direction := .direction -}}
    <div class="col-6 d-flex justify-content-{{ $direction }} align-items-center">
        <div class="d-flex">
            <div class="d-flex timeline-semi-circle-{{ $direction }} fa-wrapper align-items-center justify-content-center">
                {{ partial "assets/icon.html" (dict "icon" (printf "%s fa-fluid" $icon)) }}
            </div>
            <div class="timeline-connector-{{ $direction }} {{ if eq $direction "start" }} order-first{{ end }}"></div>
        </div>
    </div>
{{- end -}}


<!-- Inline partial to render icon -->
{{- define "partials/timeline-panel.html" -}}
    {{- $content := .content -}}
    {{- $color := .color -}}
    {{- $title := .title -}}
    {{- $direction := .direction -}}

    <div class="col-6 d-flex align-items-center">
        <div class="d-flex h-100">
            <div class="timeline-panel-{{ $direction }}"></div>
            <div class="timeline-description-text-{{ $direction }} p-3">
                <p class="fs-4 fw-bold mb-0 text-uppercase text-{{ $color }}">{{ $title }}</p>
                {{ $content }}
            </div>
        </div>
    </div>    
{{- end -}}

<div class="container p-0 d-none d-md-block mb-5">
    {{ range $index, $item := $entries }}
        <div class="row timeline timeline-{{ $item.color }} timeline-dot g-0 ">
            {{ if eq (mod $index 2) 1 }}
                {{ partial "partials/timeline-panel.html" (dict "content" $item.content "color" $item.color "title" $item.title "direction" "start") }}
                {{ partial "partials/timeline-icon.html" (dict "icon" $item.icon "direction" "start") }}
            {{ else }}
                {{ partial "partials/timeline-icon.html" (dict "icon" $item.icon "direction" "end") }}
                {{ partial "partials/timeline-panel.html" (dict "content" $item.content "color" $item.color "title" $item.title "direction" "end") }}
            {{ end }}
        </div>
        <div class="row timeline g-0 p-3"> </div>
    {{ end }}
</div>
